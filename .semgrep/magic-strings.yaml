rules:
  - id: magic-string-comparison-python
    message: "Magic string comparison - consider using a typed enum instead of '$VALUE'"
    severity: WARNING
    languages: [python]
    patterns:
      - pattern-either:
          - pattern: $X.$FIELD == "$VALUE"
          - pattern: $X.$FIELD != "$VALUE"
          - pattern: $FIELD == "$VALUE"
      - pattern-not: $FIELD = "$VALUE"
      - metavariable-regex:
          metavariable: $VALUE
          regex: ^[a-z][a-z0-9_]{1,20}$
      - metavariable-regex:
          metavariable: $FIELD
          regex: ^(status|state|type|kind|mode|zone|role|phase|stage|level|category|visibility|permission)$|_status$|_state$|_type$|_kind$|_mode$
    paths:
      exclude:
        - "**/tests/"
        - "**/test_*.py"
        - "**/*_test.py"
        - "**/schemas.py"
        - "**/conftest.py"
        - "**/alembic/"
        - "**/migrations/"
    metadata:
      category: type-safety
      fix: |
        Define an enum in your schemas.py file:

        from enum import Enum

        class MyStatus(str, Enum):
            VALUE_A = "value_a"
            VALUE_B = "value_b"

        Then use: MyStatus.VALUE_A.value

  - id: magic-string-in-list-python
    message: "Magic string in list check for '$FIELD' - consider using enum values"
    severity: WARNING
    languages: [python]
    patterns:
      - pattern-either:
          - pattern: $X.$FIELD in ["...", ...]
          - pattern: $X.$FIELD not in ["...", ...]
      - metavariable-regex:
          metavariable: $FIELD
          regex: ^(status|state|type|kind|mode)$|_status$|_state$|_type$
    paths:
      exclude:
        - "**/tests/"
        - "**/schemas.py"
